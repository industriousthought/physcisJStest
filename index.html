<html>

    <head>

        <script src="node_modules/requirejs/require.js"></script>

    </head>

    <body>

        <script>
            require.config({

                baseUrl: './',

                // ...

                packages: [

                {

                    name: 'physicsjs',

                    location: 'node_modules/PhysicsJS_wip/physicsjs',

                    main: 'physicsjs-full.js'

                }

                ],

                //...

            });



            require([

                'physicsjs',

                'physicsjs/behaviors/edge-collision-detection',

                'physicsjs/integrators/improved-euler',

                'physicsjs/behaviors/body-impulse-response',

                'physicsjs/behaviors/sweep-prune',

                //'physicsjs/behaviors/body-collision-detection',

                'physicsjs/behaviors/constant-acceleration',

                'physicsjs/renderers/canvas',

                'physicsjs/bodies/circle', // will mix into the PhysicsJS library

                'physicsjs/bodies/sprite',

                'physicsjs/bodies/rectangle',

                'physicsjs/bodies/convex-polygon'


                ], function( Physics ){


                    Physics(function( world ){

                        var makeSprite = function(options) {

                            var sprite = Physics.body('sprite', options);

                            world.add( sprite );

                            world.on('step', function() {
                                sprite.animate();
                            });

                            return sprite;

                        };

                        var makePlayer = function(options) {
                        
                            return makeSprite({

                                radius: 10,

                                x: options.x,

                                y: options.y,

                                texMap: {

                                    scaler: .5,

                                    x: [6, 5],

                                    y: 2,

                                    activity: 0
                                },

                                styles: {

                                    width: 1500,

                                    height: 420,
                                    
                                    src: 'player/img/player.png'


                                }   
                            });
                            

                        };

                        var makeZombie = function(options) {
                        
                            makeSprite({

                                radius: 10,

                                x: options.x,

                                y: options.y,

                                texMap: {

                                    scaler: .5,

                                    x: [6, 5, 2],

                                    y: 3,

                                    activity: 1
                                },

                                styles: {

                                    width: 1500,

                                    height: 420,
                                    
                                    src: 'zombie/img/zombie' + options.type + '.png'


                                }   
                            });
                            

                        };

                        window.w = world;
                        var renderer = Physics.renderer('canvas', {

                            el: 'viewport', // id of the canvas element

                            width: 500,

                            height: 500

                        });

                        world.add( renderer );

                        var integrator = Physics.integrator('improved-euler', {
                            
                            drag: .9
                            
                        });

                        world.add( integrator );




                        world.render();

                        Physics.util.ticker.on(function( time, dt ){

                            world.step( time );

                        });


                        // start the ticker

                        Physics.util.ticker.start();

                        world.on('step', function(){

                            world.render();

                        });

                        //world.add( Physics.behavior('constant-acceleration') );

                        var bounds = Physics.aabb(0, 0, 500, 500);

                        world.add( Physics.behavior('edge-collision-detection', {

                            aabb: bounds,

                            restitution: 0.3

                        }) );

                        // ensure objects bounce when edge collision is detected

                        world.add( Physics.behavior('body-impulse-response') );





                        //world.add( Physics.behavior('body-collision-detection') );

                        //world.add( Physics.behavior('sweep-prune') );

                        makeZombie({x: 90, y: 90, type: 2});

                        var player = makePlayer({x: 150, y: 150});

                
                        document.addEventListener('keydown', function(event) {
                            console.log(event.keyCode);

                        }, false);

                    });

                }
            );


        </script>

        <canvas id="viewport" width="500" height="500"></canvas>

    </body>

</html>

